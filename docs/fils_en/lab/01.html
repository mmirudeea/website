<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-fils_en docs-doc-page docs-doc-id-lab/01/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">01 - Debug | Microprocessor Architecture</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://pmrust.pages.upb.ro/img/docusaurus-social-card.png"><meta data-rh="true" name="twitter:image" content="https://pmrust.pages.upb.ro/img/docusaurus-social-card.png"><meta data-rh="true" property="og:url" content="https://pmrust.pages.upb.ro/docs/fils_en/lab/01"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="fils_en"><meta data-rh="true" name="docusaurus_tag" content="docs-default-fils_en"><meta data-rh="true" name="docsearch:version" content="fils_en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-fils_en"><meta data-rh="true" property="og:title" content="01 - Debug | Microprocessor Architecture"><meta data-rh="true" name="description" content="Using debug tools to run embassy-rs firmware"><meta data-rh="true" property="og:description" content="Using debug tools to run embassy-rs firmware"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://pmrust.pages.upb.ro/docs/fils_en/lab/01"><link data-rh="true" rel="alternate" href="https://pmrust.pages.upb.ro/docs/fils_en/lab/01" hreflang="en"><link data-rh="true" rel="alternate" href="https://pmrust.pages.upb.ro/docs/fils_en/lab/01" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.6dc7d0ad.css">
<script src="/assets/js/runtime~main.6ff8a36a.js" defer="defer"></script>
<script src="/assets/js/main.4f56df1b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Microprocessor Architecture" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Microprocessor Architecture" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Microprocessor Architecture</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/fils_en/category/lecture">Lecture</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/fils_en/category/lab">Lab</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/fils_en/category/project">Project</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/fils_en/category/tutorials">Tutorials</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/fils_en/lab/01">FILS English</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/acs_cc/lab/01">ACS CC</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/fils_en/lab/01">FILS English</a></li></ul></div><a href="https://www.github.com/upb-pmrust/website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/fils_en/welcome">Welcome</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/fils_en/category/lecture">Lecture</a><button aria-label="Expand sidebar category &#x27;Lecture&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/fils_en/category/lab">Lab</a><button aria-label="Collapse sidebar category &#x27;Lab&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/fils_en/lab/00">00 - Intro to Rust</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/fils_en/lab/01">01 - Debug</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/fils_en/lab/02">02 - GPIO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/fils_en/lab/03">03 - PWM &amp; ADC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/fils_en/lab/04">04 - Asynchronous Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/fils_en/lab/05">05 - Serial Peripheral Interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/fils_en/lab/06">06 - Inter-Integrated Circuit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/fils_en/lab/07">07 - Wi-Fi</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/fils_en/category/project">Project</a><button aria-label="Expand sidebar category &#x27;Project&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/fils_en/category/tutorials">Tutorials</a><button aria-label="Expand sidebar category &#x27;Tutorials&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/fils_en/category/lab"><span itemprop="name">Lab</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">01 - Debug</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: FILS English</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>01 - Debug</h1></header>
<p>This lab will teach you how to debug and run programs written in Rust and <a href="https://embassy.dev" target="_blank" rel="noopener noreferrer">embassy</a> on the Raspberry Pi Pico boards.</p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="concepts">Concepts<a href="#concepts" class="hash-link" aria-label="Direct link to Concepts" title="Direct link to Concepts">​</a></h2>
<ul>
<li>How to debug a microcontroller&#x27;s firmware</li>
<li>How the binary of the firmware looks like and how to inspect it</li>
<li>How to cross-compile Rust software</li>
<li>How to use <code>probe-rs</code> for RP2 processors</li>
<li>How to print messages from a microcontroller</li>
<li>How to use the Visual Studio Code probe-rs extension</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="resources">Resources<a href="#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources">​</a></h2>
<ol>
<li><strong>Raspberry Pi Ltd</strong>, <em><a href="https://datasheets.raspberrypi.com/rp2350/rp2350-datasheet.pdf" target="_blank" rel="noopener noreferrer">RP2350 Datasheet</a></em></li>
</ol>
<ul>
<li>Chapter 4 - <em>Memory</em>
<ul>
<li>Section 4.1 - <em>ROM</em></li>
<li>Section 4.2 - <em>SRAM</em></li>
<li>Section 4.3 - <em>Boot RAM</em></li>
</ul>
</li>
<li>Chapter 5 - <em>Bootrom</em></li>
</ul>
<ol start="2">
<li><a href="https://probe.rs/docs/overview/about-probe-rs/" target="_blank" rel="noopener noreferrer">probe-rs&#x27;s documentation</a></li>
<li><a href="https://docs.rs/rp235x-hal/latest/rp235x_hal/index.html" target="_blank" rel="noopener noreferrer">rp235x-hal documentation</a></li>
<li><a href="https://embassy.dev/book/dev/runtime.html" target="_blank" rel="noopener noreferrer">Embassy documentation</a></li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="software-prerequisites">Software Prerequisites<a href="#software-prerequisites" class="hash-link" aria-label="Direct link to Software Prerequisites" title="Direct link to Software Prerequisites">​</a></h2>
<p>Please make sure that you have these installed.</p>
<ul>
<li><a href="https://www.rust-lang.org/learn/get-started" target="_blank" rel="noopener noreferrer">Rust</a></li>
<li>Rust ARMv8-M target - <code>rustup target add thumbv8m.main-none-eabihf</code></li>
<li><a href="https://probe.rs" target="_blank" rel="noopener noreferrer">probe-rs</a></li>
<li>cargo binutils - <code>cargo install cargo-binutils</code></li>
<li>Rust LLVM Tools - <code>rustup component add llvm-tools</code></li>
<li><a href="https://code.visualstudio.com" target="_blank" rel="noopener noreferrer">Visual Studio Code</a>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=probe-rs.probe-rs-debugger" target="_blank" rel="noopener noreferrer">Debugger for probe-rs</a></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="debugger">Debugger<a href="#debugger" class="hash-link" aria-label="Direct link to Debugger" title="Direct link to Debugger">​</a></h2>
<p>Developing software (<em>firmware</em><sup><a href="#user-content-fn-firmware" id="user-content-fnref-firmware" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>) on devices is a little different from standard computer applications. The main difference
is that the software is developed and compiled on the computer and then
uploaded and run on a separate device.</p>
<p>Each development board defines its own way of uploading software to it. Some boards, like the Raspberry Pi Picos, provide a <em>simulated</em> USB drive
where users can copy a file, others, like the ESP32 boards, provide a WiFi Access Point and a web interface.</p>
<p>One method that all boards have in common is using the <em>debug interface</em>. Microcontrollers provide a special hardware interface
for debugging purposes. Using specialized hardware, developers can:</p>
<ul>
<li>stop the processor any time</li>
<li>ask the processor to execute one instruction at a time</li>
<li>read and write the processor&#x27;s memory (RAM)</li>
<li>read and write the processor&#x27;s Flash (Storage)</li>
<li>read the processor&#x27;s registers</li>
<li>access special debugging interfaces for sending log messages</li>
</ul>
<p>These functions allow developers to upload programs and observe the program&#x27;s behavior.</p>
<p>There are several debugging protocols available, the most common of them being JTAG and SWD. The RP2 processors use SWD.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>When placed in production, the <strong>debug interface should be disabled</strong>. Users of the production device should
never be able to access such an interface and tamper with the device&#x27;s program.</p><p>Each microcontroller offers a way in which the debug interface can be permanently disabled or restricted.</p></div></div>
<p>The Raspberry Pi Pico can be debugged using one of the two pieces of hardware:</p>
<ul>
<li>The Raspberry Pi Debug Probe</li>
<li>A secondary Raspberry Pi Pico</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="raspberry-pi-debug-probe">Raspberry Pi Debug Probe<a href="#raspberry-pi-debug-probe" class="hash-link" aria-label="Direct link to Raspberry Pi Debug Probe" title="Direct link to Raspberry Pi Debug Probe">​</a></h3>
<p>Professional debuggers, while offering a lot of features, are usually expensive. Raspberry Pi provides the <a href="https://www.raspberrypi.com/products/debug-probe/" target="_blank" rel="noopener noreferrer">Debug Probe</a>, an affordable debug device
that uses an RP2040 processor. It is similar to a Raspberry Pi Pico board, just that it has a smaller form factor and
provides debug cables.</p>
<p>The firmware running on the debug device is open source and available on <a href="https://github.com/raspberrypi/debugprobe" target="_blank" rel="noopener noreferrer">github</a>. It is written in C and
it uses <a href="https://www.freertos.org" target="_blank" rel="noopener noreferrer">FreeRTOS</a>. It is compatible with both versions of the RP2 processors, RP2040 and RP2350.</p>
<p>The details about the wiring are available on the Pico Debug Probe&#x27;s <a href="https://www.raspberrypi.com/documentation/microcontrollers/debug-probe.html#getting-started" target="_blank" rel="noopener noreferrer">website</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="secondary-pico">Secondary Pico<a href="#secondary-pico" class="hash-link" aria-label="Direct link to Secondary Pico" title="Direct link to Secondary Pico">​</a></h3>
<p>As the debugger&#x27;s firmware is open source, an additional Raspberry Pi Pico can be used as a debugger.</p>
<p>The details about the wiring are available in the <a href="https://datasheets.raspberrypi.com/pico/getting-started-with-pico.pdf" target="_blank" rel="noopener noreferrer">Getting started with Raspberry Pi
Pico-series</a> in the <em>Debug with a second Pico or Pico 2</em> section.</p>
<p><img decoding="async" loading="lazy" alt="A Pico debugging another Pico" src="/assets/images/pico_debug-c81011548c65e602cea6222ddbe69097.webp" width="782" height="594" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The lab board uses RP2040 processor soldered to the PCB as a debugger. It runs the <a href="https://github.com/raspberrypi/debugprobe" target="_blank" rel="noopener noreferrer">debugprobe</a> firmware and has
traces soldered to Raspberry Pi Pico&#x27;s socket.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="debugger-software">Debugger software<a href="#debugger-software" class="hash-link" aria-label="Direct link to Debugger software" title="Direct link to Debugger software">​</a></h2>
<p>Hardware debuggers require specialized software on the host computer (the computer used for development) to
communicate with and control the target device (the Raspberry Pi Pico 2 in this case). These software tools provide
essential debugging capabilities, such as setting breakpoints, inspecting
memory, and stepping through code execution. While most debugger vendors offer
proprietary software tailored to their specific hardware, developers often seek
more flexible or platform-independent solutions. Fortunately, there are several
open-source alternatives that support a wide range of debugging probes and
microcontrollers.</p>
<p>One widely used open-source tool is <a href="https://openocd.org" target="_blank" rel="noopener noreferrer">OpenOCD</a>, which
provides a powerful and configurable interface for debugging and programming
ARM and RISC-V devices, including the Raspberry Pi Pico 2. OpenOCD supports a
variety of debug probes and allows integration with GDB for source-level
debugging.</p>
<p>Another popular option is <a href="https://pyocd.io" target="_blank" rel="noopener noreferrer">PyOCD</a>, a Python-based tool
designed primarily for ARM Cortex-M microcontrollers. It offers an easy-to-use
command-line interface, built-in support for CMSIS-DAP debug probes, and
seamless integration with debugging environments like GDB and Visual Studio
Code.</p>
<p>For developers working in Rust or looking for an alternative that is optimized
for modern workflows, <a href="https://probe.rs" target="_blank" rel="noopener noreferrer">probe-rs</a> provides a Rust-based
debugging and flashing tool that supports multiple probe types, including
CMSIS-DAP and J-Link. It offers a simple API, making it a great choice for both
manual debugging and automated workflows.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cross-compiling">Cross-compiling<a href="#cross-compiling" class="hash-link" aria-label="Direct link to Cross-compiling" title="Direct link to Cross-compiling">​</a></h2>
<p>Cross-compiling is the process of building software on one system (the host)
that is intended to run on a different system (the target). This is necessary
when developing for embedded systems like the Raspberry Pi Pico 2 because the
target device has a different processor architecture than the development
computer. Unlike normal compiling, where the compiled binary runs on the same
system that builds it, cross-compiling generates machine code suitable for the
target architecture.</p>
<p>In Rust, this is handled by specifying a target triple.
For example, when using <code>cargo build</code> for embedded development, Rust compiles
the firmware for the microcontroller&#x27;s architecture and flashes it to the
device.</p>
<p>For example, cross-compiling for the Raspberry Pi Pico 2 requires the
<code>thumbv8m.main-none-eabihf</code> triple. It tells the compiler to build code
for:</p>
<ul>
<li>the <strong>ARMv8-M Mainline</strong> (<code>thumbv8m.main</code>) architecture</li>
<li>that runs bare metal, <strong>without an operating system</strong> available (<code>none</code>)</li>
<li>and uses the <strong>Embedded Application Binary Interface</strong> (<code>eabi</code>) <strong>with hardware floating point</strong> support</li>
</ul>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cargo</span><span class="token plain"> build </span><span class="token parameter variable" style="color:#36acaa">--target</span><span class="token plain"> thumbv8m.main-none-eabihf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-a-configuration-file">Using a configuration file<a href="#using-a-configuration-file" class="hash-link" aria-label="Direct link to Using a configuration file" title="Direct link to Using a configuration file">​</a></h3>
<p>Instead of providing the target triple in the command line every time, <code>cargo</code> offers the
possibility of writing it in a configuration file called <code>.cargo/config.toml</code>.</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token table class-name">build</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key property" style="color:#36acaa">target</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;thumbv8m.main-none-eabihf&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This sets the default compilation target to <code>thumbv8m.main-none-eabihf</code>,
ensuring that <code>cargo</code> always builds the project for an <em>ARMv8-M Mainline</em>
microcontroller with hardware floating-point support.</p>
<p>With this setting, running <code>cargo build</code> or <code>cargo run</code> automatically
compiles for the specified target, making cross-compilation seamless.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The target triple for the Raspberry Pi Pico 1 is <code>thumbv6m-none-eabi</code>.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="binary-format">Binary format<a href="#binary-format" class="hash-link" aria-label="Direct link to Binary format" title="Direct link to Binary format">​</a></h2>
<p>To be able to properly run the code, the Raspberry Pi Pico (1 and 2) expects a certain binary format.
The compiler and the linker, both provided by Rust, have to make sure that the generated
binary code meets the requirements, otherwise the Raspberry Pi Pico will not start.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sections">Sections<a href="#sections" class="hash-link" aria-label="Direct link to Sections" title="Direct link to Sections">​</a></h3>
<p>The binary file is generated as a collection of sections. Each section has:</p>
<ul>
<li>size (in bytes)</li>
<li>the address of the section in RAM when the firmware runs (<code>VMA</code>, <em>Virtual Memory Address</em>)</li>
<li>the address of the section when it is stored into flash (<code>LMA</code>, <em>Load Memory Address</em>)</li>
<li>the type</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="section-types">Section types<a href="#section-types" class="hash-link" aria-label="Direct link to Section types" title="Direct link to Section types">​</a></h4>
<table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><em>TEXT</em></td><td>Contains the binary code the the processor executes</td></tr><tr><td><em>DATA</em></td><td>Contains data used by the firmware, usually variables</td></tr><tr><td><em>BSS</em></td><td>Contains uninitialized or initialized with <code>0</code> data, usually uninitialized global variables and variables initialized to 0</td></tr><tr><td><em>DEBUG</em></td><td>Contains debug information used by the debugger software.</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>DEBUG type sections have no addresses (<code>0x00000000</code>), as they are never loaded to the device. These sections
are used by the debugging software to display meaningful information to developers. Among the information
store here we can find:</p><ul>
<li>source code to binary code mappings</li>
<li>variable name mappings</li>
<li>function name mappings</li>
</ul></div></div>
<p>The binary file for the Raspberry Pi Pico 2 is organized to ensure proper
execution and booting, with specific sections for the developer&#x27;s code and
variables. The first section that holds the developer’s code is the <em><code>.text</code></em>
section. This section contains all the executable instructions that make up
the application’s logic. It is located after the <em><code>.start_block</code></em> and
<em><code>.vector_table</code></em> sections, and it is placed into flash memory, ready to
be loaded and executed when the system starts. This is where the developer&#x27;s
main program logic resides.</p>
<p>Following the <em><code>.text</code></em> section, the <em><code>.data</code></em> section contains
initialized global and static variables. These variables are stored in flash
memory and are copied into RAM at startup. The developer’s predefined values
for global variables are stored here, so they can be used during runtime.
In contrast, the <em><code>.bss</code></em> section holds uninitialized variables. These
variables are zeroed out during the boot process and are stored in RAM to
ensure that the program can access them during execution.</p>
<p>The <em><code>.rodata</code></em> section follows, storing read-only data like string literals
and constant values. These values are also stored in flash memory and are used
throughout the application without modification. The <em><code>.rodata</code></em> section
helps to conserve RAM by storing constant data in the flash memory instead.</p>
<p>Once the developer’s code and variables are in place, the firmware image ends
with the <em><code>.end_block</code></em> section. This section marks the end of the firmware
and ensures that no additional data is written past this point. It is important
for memory management, preventing the accidental overwrite of critical memory
regions during updates or execution.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="linker-script">Linker Script<a href="#linker-script" class="hash-link" aria-label="Direct link to Linker Script" title="Direct link to Linker Script">​</a></h3>
<p>The compiler is responsible for generating the sections and the linker is responsible for
putting the sections in the right place in the binary. Rust uses a linker script to
instruct the linker where to put the sections. The linker script is usually called
<code>memory.x</code> and is located in the firmware&#x27;s root folder.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>The linker script is in the firmware&#x27;s crate root folder, not in the <code>src</code> folder.</p></div></div>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Raspberry Pi Pico 2</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Raspberry Pi Pico</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-ld codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ld codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MEMORY </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * The RP2350 has either external or internal flash.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * 2 MiB is a safe default here, although a Pico 2 has 4 MiB.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FLASH </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ORIGIN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x10000000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LENGTH </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2048K</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * RAM consists of 8 banks, SRAM0-SRAM7, with a striped mapping.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * This is usually good for performance, as it distributes load on</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * those banks evenly.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RAM </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ORIGIN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x20000000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LENGTH </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">512K</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * RAM banks 8 and 9 use a direct mapping. They can be used to have</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * memory areas dedicated for some specific job, improving predictability</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * of access times.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Example: Separate stacks for core0 and core1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SRAM4 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ORIGIN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x20080000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LENGTH </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4K</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SRAM5 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ORIGIN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x20081000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LENGTH </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4K</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SECTIONS </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* ### Boot ROM info</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Goes after .vector_table, to keep it in the first 4K of flash</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * where the Boot ROM (and picotool) can find it</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token section keyword" style="color:#00009f">.start_block</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ALIGN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        __start_block_addr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token location-counter important">.</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">KEEP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token section keyword" style="color:#00009f">.start_block</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">KEEP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token section keyword" style="color:#00009f">.boot_info</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> FLASH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> INSERT AFTER </span><span class="token section keyword" style="color:#00009f">.vector_table</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* move .text to start /after/ the boot info */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_stext </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ADDR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token section keyword" style="color:#00009f">.start_block</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SIZEOF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token section keyword" style="color:#00009f">.start_block</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SECTIONS </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* ### Picotool &#x27;Binary Info&#x27; Entries</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Picotool looks through this block (as we have pointers to it in our</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * header) to find interesting information.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token section keyword" style="color:#00009f">.bi_entries</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ALIGN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* We put this in the header */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        __bi_entries_start </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token location-counter important">.</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Here are the entries */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">KEEP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token section keyword" style="color:#00009f">.bi_entries</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Keep this block a nice round size */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token location-counter important">.</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ALIGN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* We put this in the header */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        __bi_entries_end </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token location-counter important">.</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> FLASH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> INSERT AFTER </span><span class="token section keyword" style="color:#00009f">.text</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SECTIONS </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* ### Boot ROM extra info</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Goes after everything in our program, so it can contain a signature.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token section keyword" style="color:#00009f">.end_block</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ALIGN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        __end_block_addr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token location-counter important">.</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">KEEP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token section keyword" style="color:#00009f">.end_block</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> FLASH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> INSERT AFTER </span><span class="token section keyword" style="color:#00009f">.uninit</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">PROVIDE</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">start_to_end </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> __end_block_addr </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> __start_block_addr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">PROVIDE</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">end_to_start </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> __start_block_addr </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> __end_block_addr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-ld codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ld codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MEMORY </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BOOT2 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ORIGIN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x10000000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LENGTH </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Here we assume you have 2048 KiB of Flash. This is what the Pi Pico</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * has, but your board may have more or less Flash and you should adjust</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * this value to suit.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FLASH </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ORIGIN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x10000100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LENGTH </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2048K</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * RAM consists of 4 banks, SRAM0-SRAM3, with a striped mapping.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * This is usually good for performance, as it distributes load on</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * those banks evenly.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RAM </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ORIGIN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x20000000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LENGTH </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">256K</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * RAM banks 4 and 5 use a direct mapping. They can be used to have</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * memory areas dedicated for some specific job, improving predictability</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * of access times.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Example: Separate stacks for core0 and core1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SRAM4 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ORIGIN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x20040000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LENGTH </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> 4k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SRAM5 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ORIGIN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x20041000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LENGTH </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> 4k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* SRAM banks 0-3 can also be accessed directly. However, those ranges</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">       alias with the RAM mapping, above. So don&#x27;t use them at the same time!</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    SRAM0 : ORIGIN = 0x21000000, LENGTH = 64k</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    SRAM1 : ORIGIN = 0x21010000, LENGTH = 64k</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    SRAM2 : ORIGIN = 0x21020000, LENGTH = 64k</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    SRAM3 : ORIGIN = 0x21030000, LENGTH = 64k</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">EXTERN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BOOT2_FIRMWARE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SECTIONS </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* ### Boot loader</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * An executable block of code which sets up the QSPI interface for</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * &#x27;Execute-In-Place&#x27; (or XIP) mode. Also sends chip-specific commands to</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * the external flash chip.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Must go at the start of external flash, where the Boot ROM expects it.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token section keyword" style="color:#00009f">.boot2</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ORIGIN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BOOT2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">KEEP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token section keyword" style="color:#00009f">.boot2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> BOOT2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> INSERT BEFORE </span><span class="token section keyword" style="color:#00009f">.text</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SECTIONS </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* ### Boot ROM info</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Goes after .vector_table, to keep it in the first 512 bytes of flash,</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * where picotool can find it</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token section keyword" style="color:#00009f">.boot_info</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ALIGN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">KEEP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token section keyword" style="color:#00009f">.boot_info</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> FLASH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> INSERT AFTER </span><span class="token section keyword" style="color:#00009f">.vector_table</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* move .text to start /after/ the boot info */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_stext </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ADDR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token section keyword" style="color:#00009f">.boot_info</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SIZEOF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token section keyword" style="color:#00009f">.boot_info</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SECTIONS </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* ### Picotool &#x27;Binary Info&#x27; Entries</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Picotool looks through this block (as we have pointers to it in our</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * header) to find interesting information.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token section keyword" style="color:#00009f">.bi_entries</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ALIGN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* We put this in the header */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        __bi_entries_start </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token location-counter important">.</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Here are the entries */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">KEEP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token section keyword" style="color:#00009f">.bi_entries</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Keep this block a nice round size */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token location-counter important">.</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ALIGN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* We put this in the header */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        __bi_entries_end </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token location-counter important">.</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> FLASH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> INSERT AFTER </span><span class="token section keyword" style="color:#00009f">.text</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="build-script">Build Script<a href="#build-script" class="hash-link" aria-label="Direct link to Build Script" title="Direct link to Build Script">​</a></h3>
<p>To connect the linker script (<code>memory.x</code>) to the compiler, Rust uses the <code>build.rs</code> file
located in the root of the firmware&#x27;s crate.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>The <code>build.rs</code> file is located in the root of the firmware&#x27;s crate, not in the <code>src</code> folder.</p></div></div>
<p>The <code>build.rs</code> file compiles before the firmware and is executed by the Rust compiler during
the compilation. The <code>build.rs</code> file writes to the <em>screen</em> compiler options that the compiler
later uses for the building of the firmware.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//! This build script copies the `memory.x` file from the crate root into</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//! a directory where the linker can always find it at build time.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//! For many projects this is optional, as the linker always searches the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//! project root directory -- wherever `Cargo.toml` is. However, if you</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//! are using a workspace or have a more complicated build setup, this</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//! build script becomes required. Additionally, by requesting that</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//! Cargo re-run the build script whenever `memory.x` is changed,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//! updating `memory.x` ensures a rebuild of the application with the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//! new memory settings.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">fs</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">File</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">io</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Write</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">path</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">PathBuf</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Put `memory.x` in our output directory and ensure it&#x27;s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// on the linker search path.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> out </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token class-name">PathBuf</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token namespace" style="opacity:0.7">env</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token function" style="color:#d73a49">var_os</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;OUT_DIR&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">File</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;memory.x&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">write_all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token macro property" style="color:#36acaa">include_bytes!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;memory.x&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property" style="color:#36acaa">println!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;cargo:rustc-link-search={}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">display</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// By default, Cargo will re-run a build script whenever</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// any file in the project changes. By specifying `memory.x`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// here, we ensure the build script is only re-run when</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// `memory.x` is changed.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property" style="color:#36acaa">println!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;cargo:rerun-if-changed=memory.x&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property" style="color:#36acaa">println!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;cargo:rustc-link-arg-bins=--nmagic&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property" style="color:#36acaa">println!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;cargo:rustc-link-arg-bins=-Tlink.x&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Required for `defmt`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property" style="color:#36acaa">println!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;cargo:rustc-link-arg-bins=-Tdefmt.x&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This example instructs the linker to use:</p>
<ul>
<li>the project&#x27;s linker script - <code>memory.x</code></li>
<li>the <code>cortex-m-rt</code> linker script - <code>link.x</code></li>
<li>the <code>defmt</code>&#x27;s linker script - <code>defmt.x</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="inspect-binaries">Inspect binaries<a href="#inspect-binaries" class="hash-link" aria-label="Direct link to Inspect binaries" title="Direct link to Inspect binaries">​</a></h3>
<p>When working in Rust for the Raspberry Pi Pico 2, <code>rust-objdump</code> can be used to
inspect the compiled binary and examine its memory layout. The output includes
various sections that are crucial for embedded development.</p>
<table><thead><tr><th>Section</th><th>Fixed Offset</th><th>Description</th></tr></thead><tbody><tr><td><em><code>.vector_table</code></em></td><td><code>0x10000000</code></td><td>Contains the initial stack pointer value and interrupt vector table. Essential for system startup and exception handling, allowing the processor to correctly respond to interrupts.</td></tr><tr><td><em><code>.start_block</code></em></td><td><code>0x10000114</code></td><td>Holds boot metadata, including information needed by the bootloader to validate and execute the firmware correctly. Ensures that the correct application runs after a reset.</td></tr><tr><td><em><code>.text</code></em></td><td>N/A</td><td>Stores executable code, typically placed in flash memory. Optimizing this section can reduce flash usage and improve execution efficiency.</td></tr><tr><td><em><code>.rodata</code></em></td><td>N/A</td><td>Contains read-only data, such as string literals and constants, stored in flash memory. Helps minimize RAM usage.</td></tr><tr><td><em><code>.data</code></em></td><td>N/A</td><td>Includes initialized variables that are stored in flash and copied to RAM during startup. Used for global and static variables requiring predefined values.</td></tr><tr><td><em><code>.bss</code></em></td><td>N/A</td><td>Represents uninitialized variables that are zeroed out in RAM before execution. Large <code>.bss</code> sections can impact RAM availability.</td></tr><tr><td><em><code>.bi_entries</code></em></td><td>N/A</td><td>Contains boot information entries used by the RP2350 ROM bootloader and firmware updater to manage and validate firmware images.</td></tr><tr><td><em><code>.end_block</code></em></td><td>N/A</td><td>Marks the end of the firmware image. This section helps bootloaders determine the total size of the firmware and ensures that no unexpected data is included beyond this point. It is used for integrity checks and defining boundaries for updates or memory protection.</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="pico-1-vs-pico-2">Pico 1 vs Pico 2<a href="#pico-1-vs-pico-2" class="hash-link" aria-label="Direct link to Pico 1 vs Pico 2" title="Direct link to Pico 1 vs Pico 2">​</a></h4>
<p>The primary difference between the Raspberry Pi Pico 1 and Pico 2 in terms of
firmware layout is the presence of the <em><code>.boot2</code></em> section in the Pico 1,
which is not present in the Pico 2. The <em><code>.boot2</code></em> section in the Pico 1
is located at a fixed offset of <code>0x10000000</code> and contains the bootloader code
along with necessary metadata for bootstrapping the device.</p>
<p>The <em><code>.vector_table</code></em>  section in the Pico 1 is placed immediately
after the <em><code>.boot2</code></em> section,
unlike the Pico 2 where it is located at the beginning of the flash memory at
<code>0x00000000</code>.</p>
<p>The Pico 2 uses the <em><code>.start_block</code></em> and <em><code>.end_block</code></em> sections
to handle boot metadata and firmware boundaries, while the Pico 1 relies on the
bootloader for these tasks. Furthermore, the Pico 1 does not have a fixed
<em><code>.end_block</code></em> section, which is used in the Pico 2 to mark the end of the
firmware image.</p>
<p>Despite these differences, both devices share a similar overall
firmware structure, with the <em><code>.text</code></em>, <em><code>.rodata</code></em>, <em><code>.data</code></em>, and <em><code>.bss</code></em>
sections serving similar purposes in both devices.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="check-section-headers">Check section headers<a href="#check-section-headers" class="hash-link" aria-label="Direct link to Check section headers" title="Direct link to Check section headers">​</a></h3>
<p>If the uploaded firmware does not boot, looking at the firmware&#x27;s sections is useful.</p>
<p>The <code>rust-objdumb</code> tool can be used to inspect firmware binaries. Using the <code>--section-headers</code>
flag will display the sections of the firmware.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Raspberry Pi Pico 2</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Raspberry Pi Pico</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rust-objdump --section-headers target/thumbv8m.main-none-eabihf/debug/</span><span class="token variable" style="color:#36acaa">$app_name</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Make sure that:</p><ul>
<li>section <code>.vector_table</code> is <code>0x114</code> long and at <code>0x10000000</code></li>
<li>section <code>.start_block</code> is at <code>0x10000114</code></li>
<li>section <code>.end_block</code> exists</li>
</ul></div></div><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Sections:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Idx Name            Size     VMA      LMA      Type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">                 00000000 00000000 00000000 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> .vector_table   00000114 </span><span class="token number" style="color:#36acaa">10000000</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000000</span><span class="token plain"> DATA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> .start_block    00000028 </span><span class="token number" style="color:#36acaa">10000114</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000114</span><span class="token plain"> DATA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> .text           0000b190 1000013c 1000013c TEXT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> .bi_entries     00000010 1000b2cc 1000b2cc DATA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> .rodata         000030e4 1000b2e0 1000b2e0 DATA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> .data           00000488 </span><span class="token number" style="color:#36acaa">20000000</span><span class="token plain"> 1000e3c4 TEXT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> .gnu.sgstubs    00000000 1000e860 1000e860 DATA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> .bss            000181bc </span><span class="token number" style="color:#36acaa">20000488</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20000488</span><span class="token plain"> BSS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">9</span><span class="token plain"> .uninit         00000400 </span><span class="token number" style="color:#36acaa">20018644</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20018644</span><span class="token plain"> BSS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> .end_block      00000000 1000e860 1000e860 DATA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain"> .defmt          00000023 00000000 00000000 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"> .debug_abbrev   0000b8bb 00000000 00000000 DEBUG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">13</span><span class="token plain"> .debug_info     000ea40f 00000000 00000000 DEBUG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token plain"> .debug_aranges  00009a70 00000000 00000000 DEBUG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain"> .debug_ranges   00032380 00000000 00000000 DEBUG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token plain"> .debug_str      000eff8d 00000000 00000000 DEBUG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">17</span><span class="token plain"> .comment        00000099 00000000 00000000 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">18</span><span class="token plain"> .ARM.attributes 0000003a 00000000 00000000 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">19</span><span class="token plain"> .debug_frame    0001b444 00000000 00000000 DEBUG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> .debug_line     0006ed68 00000000 00000000 DEBUG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">21</span><span class="token plain"> .debug_loc      00001e3a 00000000 00000000 DEBUG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">22</span><span class="token plain"> .symtab         00007530 00000000 00000000 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">23</span><span class="token plain"> .shstrtab       00000101 00000000 00000000 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">24</span><span class="token plain"> .strtab         0000f6ca 00000000 00000000 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rust-objdump --section-headers target/thumbv6m-none-eabi/debug/</span><span class="token variable" style="color:#36acaa">$app_name</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Make sure that:</p><ul>
<li>section <code>.boot2</code> is <code>0x100</code> long and at <code>0x10000000</code></li>
<li>section <code>.vector_table</code> is <code>0x0c0</code> long and at <code>0x10000100</code></li>
</ul></div></div><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Sections:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Idx Name            Size     VMA      LMA      Type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">                 00000000 00000000 00000000 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> .vector_table   000000c0 </span><span class="token number" style="color:#36acaa">10000100</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000100</span><span class="token plain"> DATA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> .boot_info      00000000 100001c0 100001c0 DATA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> .boot2          00000100 </span><span class="token number" style="color:#36acaa">10000000</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000000</span><span class="token plain"> DATA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> .text           000027d8 100001c0 100001c0 TEXT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> .bi_entries     00000000 </span><span class="token number" style="color:#36acaa">10002998</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10002998</span><span class="token plain"> DATA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> .rodata         00000d00 </span><span class="token number" style="color:#36acaa">10002998</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10002998</span><span class="token plain"> DATA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> .data           00000038 </span><span class="token number" style="color:#36acaa">20000000</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10003698</span><span class="token plain"> DATA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> .gnu.sgstubs    00000000 100036e0 100036e0 DATA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">9</span><span class="token plain"> .bss            00000008 </span><span class="token number" style="color:#36acaa">20000038</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20000038</span><span class="token plain"> BSS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> .uninit         00000400 </span><span class="token number" style="color:#36acaa">20000040</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20000040</span><span class="token plain"> BSS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain"> .defmt          0000000a 00000000 00000000 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"> .debug_abbrev   00005fc3 00000000 00000000 DEBUG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">13</span><span class="token plain"> .debug_info     000aa259 00000000 00000000 DEBUG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token plain"> .debug_aranges  00006df8 00000000 00000000 DEBUG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain"> .debug_ranges   0001d2d8 00000000 00000000 DEBUG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token plain"> .debug_str      000e4147 00000000 00000000 DEBUG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">17</span><span class="token plain"> .comment        00000099 00000000 00000000 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">18</span><span class="token plain"> .ARM.attributes 00000032 00000000 00000000 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">19</span><span class="token plain"> .debug_frame    0001466c 00000000 00000000 DEBUG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> .debug_line     00049f95 00000000 00000000 DEBUG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">21</span><span class="token plain"> .debug_loc      0000141b 00000000 00000000 DEBUG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">22</span><span class="token plain"> .symtab         00001ec0 00000000 00000000 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">23</span><span class="token plain"> .shstrtab       000000fb 00000000 00000000 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">24</span><span class="token plain"> .strtab         000035f6 00000000 00000000 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><code>cargo objdumb</code> and <code>rust-objdump</code> tools use llvm&#x27;s <code>objdump</code> tool.
Some terminals do not parse parameters proxied to <code>llvm-objdump</code> command.
If this happens please use <code>llvm-objdump</code> script directly like so</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">llvm-objdump </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">path_to_binary</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--section.headers</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="empty-firmware">Empty firmware<a href="#empty-firmware" class="hash-link" aria-label="Direct link to Empty firmware" title="Direct link to Empty firmware">​</a></h2>
<p>An <em>empty firmware</em> is a piece of software running on a device that boots and puts
the device in an endless loop. To boot, the firmware has to perform the following:</p>
<ul>
<li>do not depend on the standard library (<code>#![no_std]</code>)</li>
<li>do not provide the standard <code>main</code> function called by the operating system (<code>#![no_main]</code>)</li>
<li>provide the <code>.start_block</code> and <code>.end_block</code> sections (or <code>.bootloader</code> for the Pico 1);</li>
<li>provide the <code>.interrupt_vector</code> section with pointers to interrupts;</li>
<li>copy the DATA sections from Flash to the correct address in RAM;</li>
<li>initialize the BSS section in RAM with 0 values</li>
<li>jump to the <code>main</code> function and never return.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-interrupt_vector-section">The <code>.interrupt_vector</code> section<a href="#the-interrupt_vector-section" class="hash-link" aria-label="Direct link to the-interrupt_vector-section" title="Direct link to the-interrupt_vector-section">​</a></h3>
<p>The <code>.interrupt_section</code> is provided by <code>rp235x_hal</code> crate (or <code>rp2040_hal</code> for the Pico 1).
Importing this crate is enough to provide a valid interrupt vector.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token attribute attr-name" style="color:#00a4db">#![no_std]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#![no_main]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// we use as _ to avoid a compiler warning</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// saying that the crate is not used</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> rp235x_hal </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-start_block-and-end_blocks">The <code>.start_block</code> and <code>.end_block</code>s<a href="#the-start_block-and-end_blocks" class="hash-link" aria-label="Direct link to the-start_block-and-end_blocks" title="Direct link to the-start_block-and-end_blocks">​</a></h3>
<p>The <code>rp235x_hal</code> crate provides the valid <code>.start_block</code> and <code>.end_block</code>.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">rp235x_hal</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">block</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">ImageDef</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[unsafe(link_section = </span><span class="token attribute attr-name string" style="color:#e3116c">&quot;.start_block&quot;</span><span class="token attribute attr-name" style="color:#00a4db">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[used]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IMAGE_DEF</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">ImageDef</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">ImageDef</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">secure_exe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Older Rust versions do not require <code>unsafe</code> around the <code>link_section</code> attribute.</p></div></div>
<p>This code creates a static variable <code>IMAGE_DEF</code> of type <code>ImageDef</code> and places it
in the <code>.start_block</code> section, a dedicated section for bootloader
or secure boot metadata. The <code>#[used]</code> attribute ensures the variable is
included in the binary, even if it isn&#x27;t directly referenced,
which is crucial for secure boot functionality or other boot-related processes.</p>
<p>The <code>secure_exe</code> function creates a <code>.start_block</code> that instructs the <code>BOOTROM</code> of the
Raspberry Pi Pico 2 to start the firmware in secure execution mode. The processor
always starts in secure execution mode and has to be switched to unsecure mode
by the firmware.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>The <code>#[used]</code> attribute is important as linkers will discard code that is
not used to lower the size of the binary. The <code>IMAGE_DEF</code> variable is not
directly used by anything in the firmware and might be discarded.</p></div></div>
<p>The <code>.end_block</code> is automatically inserted by the linker using the <code>memory.x</code> file.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-main-function">The <code>main</code> function<a href="#the-main-function" class="hash-link" aria-label="Direct link to the-main-function" title="Direct link to the-main-function">​</a></h3>
<p>When writing software that runs on top of an operating system, the operating system
is responsible for initializing the memory of the software and the calling
of the <code>main</code> function.</p>
<p>Embedded firmware that does not run on top of an operating system has to perform the
memory initialization tasks and calling the <code>main</code> function itself.</p>
<p>The Rust Embedded Working Group provides a crate called <code>cortex_m_rt</code> (<em>Cortex-M Runtime</em>) that
exposes the macro <code>entry!</code> to perform these tasks. The macro is placed on top of a function
that takes no parameters and does no return (<code>!</code>).</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">cortex_m_rt</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token plain">entry</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[entry]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">loop</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The important aspect is the usage of the <code>#[entry]</code> macro,
while the name of the function does not need to be <code>main</code>.</p></div></div>
<p>The <code>entry!</code> macro will rewrite the <code>main</code> function and add all the initialization code.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Different frameworks like <code>embassy-rs</code> will use different entry macros.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="flashing-firmware">Flashing firmware<a href="#flashing-firmware" class="hash-link" aria-label="Direct link to Flashing firmware" title="Direct link to Flashing firmware">​</a></h2>
<p>To run firmware on the Raspberry Pi Pico 2, the
compiled program must be transferred to the device&#x27;s flash (non-volatile) memory. This
process is called <em>flashing</em>, and it ensures that the firmware remains on the
device even after a power reset.</p>
<p>A flashing tool is software that communicates
with the device through a debug probe or other interfaces, such as USB or
<em>UART</em>, to write the firmware to the correct memory location. Many flashing tools
also verify the uploaded firmware to ensure data integrity and provide
additional features like chip erasing or memory protection configuration.</p>
<p>When developing Rust firmware for the Raspberry Pi Pico 2, <code>probe-rs</code> is the
preferred flashing tool to upload and debug code.</p>
<p>After building the firmware using <code>cargo build</code>, an ELF file will be generated in
<code>target/thumbv8m.main-none-eabihf/debug/$app_name</code>. This file can be flashed to the
board using:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">probe-rs run </span><span class="token parameter variable" style="color:#36acaa">--chip</span><span class="token plain"> RP235x target/thumbv8m.main-none-eabihf/debug/</span><span class="token variable" style="color:#36acaa">$app_name</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Replace $app_name with the name of the firmware&#x27;s crate, usually the name of the folder
where the firmware source resides.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-cargo-run">Using <code>cargo run</code><a href="#using-cargo-run" class="hash-link" aria-label="Direct link to using-cargo-run" title="Direct link to using-cargo-run">​</a></h3>
<p>On a computer, running a Rust program with <code>cargo run</code> compiles the source
code into an executable and immediately starts it. This command streamlines
development by combining compilation and execution into a single step.</p>
<p>A similar process applies when using <code>cargo run</code> to develop firmware for the Raspberry
Pi Pico 2. Instead of just compiling and running a program on the host computer,
<code>cargo run</code> cross compiles the firmware and flashes it onto the target device in one
step. Under the hood, it uses <code>probe-rs</code> to detect the connected debug probe
and handle the flashing process automatically. This eliminates the need for
separate flashing tools, making firmware development as seamless as running a
Rust program on a computer.</p>
<p>To be able to use <code>cargo run</code> for flashing firmware, a runner has to be specified in the
<code>.cargo/config.toml</code> file. The following lines have to be added.</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token table class-name">target.&#x27;cfg(all(target_arch = &quot;arm&quot;, target_os = &quot;none&quot;))&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key property" style="color:#36acaa">runner</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;probe-rs run --chip RP235x&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Make sure the correct <code>[target]</code> is specified in the <code>.cargo/config.toml</code> configuration file. See the
<a href="#using-a-configuration-file">cross-compiling</a> section.</p></div></div>
<p>This setup makes flashing firmware to the Raspberry Pi Pico 2 as simple
as running a Rust program on a computer.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="printing-messages">Printing messages<a href="#printing-messages" class="hash-link" aria-label="Direct link to Printing messages" title="Direct link to Printing messages">​</a></h2>
<p>When developing embedded applications, debugging can be challenging due to
the lack of standard output (such as <code>println!</code>). Printed messages need to be generated
on the target device and sent to the host computer
where they are displayed to a console.</p>
<p>Two common techniques to
retrieve debug information from an embedded system are <em>semihosting</em> and<br>
<em><code>defmt</code></em>. Both methods provide insight into program execution but work<br>
<!-- -->differently and are suited for different use cases.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="semihosting">Semihosting<a href="#semihosting" class="hash-link" aria-label="Direct link to Semihosting" title="Direct link to Semihosting">​</a></h3>
<p>Semihosting is a debugging mechanism that allows an embedded system to
communicate with a host computer via a debugger. It enables operations like:</p>
<ul>
<li>printing debug messages (<code>println!</code>)</li>
<li>reading input from the host</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Semihosting requires a hardware debugger.</p></div></div>
<p>This works in there steps:</p>
<ol>
<li>The embedded firmware executes a special <em>semihosting instruction</em>.</li>
<li>The debugger software (e.g., <code>gdb</code> with <code>probe-rs</code>) intercepts the request.</li>
<li>The debugger software processes the request and returns the result to the firmware.</li>
</ol>
<p>Semihosting is very simple to implement, but has a big drawback, it is slow
and cannot be used in production.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Printing a panic message takes more than 2 seconds.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="printing-a-message">Printing a message<a href="#printing-a-message" class="hash-link" aria-label="Direct link to Printing a message" title="Direct link to Printing a message">​</a></h4>
<p>Semihosting for Cortex-M is implemented by the <code>cortex_m_semihosting</code> crate. This
exposes the <code>hprintln!</code>, a macro used for printing messages to the host system.
This macro behaves like <code>println!</code>, but instead of
printing to the terminal, it sends the output to the debugger, which then
transmits it to the host system.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token attribute attr-name" style="color:#00a4db">#![no_std]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#![no_main]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">cortex_m_rt</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token plain">entry</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">cortex_m_semihosting</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token plain">hprintln</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[entry]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token macro property" style="color:#36acaa">hprintln!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Device has started&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// write the rest of the code here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">loop</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The main advantage of semihosting is that it works with all the embedded frameworks.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="printing-the-panic">Printing the panic<a href="#printing-the-panic" class="hash-link" aria-label="Direct link to Printing the panic" title="Direct link to Printing the panic">​</a></h4>
<p>The Rust language provides a special function called the <em>panic handler</em> that gets
called in case things go wrong. For instance attempting to divide to 0 will call the
panic handler.</p>
<p>In embedded systems, the <em>panic handler</em> is used to handle unexpected runtime errors.<br>
<!-- -->Using <code>hprintln!</code> in the panic handler allows developers to print helpful debug<br>
<!-- -->messages when the program encounters a panic, making it easier to solve issues.</p>
<p>When using <code>#![no_std]</code>, developers have to define their own panic handler.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token attribute attr-name" style="color:#00a4db">#![no_std]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#![no_main]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">cortex_m_rt</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token plain">entry</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">cortex_m_semihosting</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token plain">hprintln</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">core</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">panic</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">PanicInfo</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[entry]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Trigger a panic by dividing by zero (for demonstration purposes)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">divide</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">23</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property" style="color:#36acaa">hprintln!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Result: {}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">loop</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Divide the two given numbers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">divide</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u32</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Define the panic handler</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[panic_handler]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">panic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token class-name">PanicInfo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Print a panic message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property" style="color:#36acaa">hprintln!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Panic occurred: {:?}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> info</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Enter an infinite loop to halt the system after a panic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">loop</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>divide_by_zero</code> function is intentionally written to trigger a panic
(dividing by zero).</p>
<ul>
<li>the panic_handler is defined using the <code>#[panic_handler]</code> attribute, when a panic occurs, this handler will be called;</li>
<li>inside the panic_handler, <code>hprintln!</code> is used to print the panic message (<code>Panic occurred: ...</code>) to the host system via semihosting.</li>
<li>the program enters an infinite loop (<code>loop {}</code>) to halt the system after a panic, preventing the device from continuing to run.</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Panic handlers are usually defined by the frameworks. <code>embassy-rs</code> does define its own panic handler.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-defmt">Using <code>defmt</code><a href="#using-defmt" class="hash-link" aria-label="Direct link to using-defmt" title="Direct link to using-defmt">​</a></h3>
<p>Another drawback of semihosting is that
all the strings used in the debug messages are stored into the firmware&#x27;s DATA
sections and are flashed to the device. All the formating of these strings
is done by the device.</p>
<p>The <a href="https://github.com/knurling-rs/defmt" target="_blank" rel="noopener noreferrer"><code>defmt</code></a> crate is a compact logging framework
designed for Rust-based embedded systems. Its name comes from <em>Deferred Formatting</em>. Instead of sending full log messages,
it transmits compressed binary data, which is later decoded on the host.</p>
<p>This works in two steps:</p>
<ol>
<li>the firmware sends compressed log data via a debug probe (e.g., using <code>probe-rs</code>) or another transport like UART (serial port);</li>
<li>the host tool (<code>defmt-print</code>) decodes the data and prints human-readable logs.</li>
</ol>
<p>Using <code>defmt</code> implies working with its own printing macros:</p>
<ul>
<li><code>error!</code> used for logging errors, that mean that the firmware cannot conitnue to correctly run;</li>
<li><code>warn!</code> used for logging warning messages, that are usually recoverable errors, and the framework can continue to run correctly;</li>
<li><code>info!</code> used for logging information messages;</li>
<li><code>debug!</code> used for logging debug messages that should not be displayed under normal functioning;</li>
<li><code>trace!</code> used for logging almost all the actions of the firmware, messages that should be enabled only when the firmware does not work correctly and needs detailed debugging.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="transports">Transports<a href="#transports" class="hash-link" aria-label="Direct link to Transports" title="Direct link to Transports">​</a></h4>
<p>One of the key features of <code>defmt</code> is its flexible transport system, allowing developers
to choose how the log data is transmitted.<br>
<!-- -->Here, we&#x27;ll highlight <em>RTT</em> (<em>Real-Time Transfer</em>) and <em>UART</em>.</p>
<p><em>RTT</em> is one of the most powerful transport solutions for embedded debugging.
It is a high-speed communication protocol that allows log data to be sent from
the embedded system to the host system in real time. RTT works through the
debugger&#x27;s <em>SWD</em> (<em>Serial Wire Debug</em>) interface, which allows communication
between the device and the host without requiring an additional <em>UART</em> or <em>USB</em>
connection.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Using <em>RTT</em> requires a debugger.</p><p><em>RTT</em> has several key advantages over traditional <em>UART</em>. It offers much higher
data transfer speeds, making it ideal for applications that need frequent
log output or high-throughput debugging. Moreover, <em>RTT</em> doesn&#x27;t require a
separate serial interface or special drivers on the host system, as the
debugger itself handles the communication. The real-time nature of <em>RTT</em> is
perfect for debugging critical, time-sensitive systems.</p></div></div>
<p><em>UART</em> is one of the oldest and most commonly used serial communication protocols
in embedded systems. It’s well-supported by almost every microcontroller and
platform, and it provides a straightforward way to send log data to a host system.
In the context of <code>defmt</code>, <em>UART</em> can be used to transmit log data as ASCII or
binary over a serial connection, where it is then decoded by a terminal or
host application.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>While <em>UART</em> is slower than RTT, it remains a popular solution due to its simplicity
and widespread availability. It can be easily set up on most microcontrollers and
is supported by many <em>USB-to-serial</em> adapters, making it accessible for both
beginners and experienced developers. However, it has limitations in terms of
speed and real-time debugging capabilities, especially in cases with large log
outputs or higher data transfer requirements.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example">Example<a href="#example" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h4>
<p>This example demonstrates how to use <code>defmt</code> for logging in an embedded system,
handle panics, and send log messages over <em>RTT</em>.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token attribute attr-name" style="color:#00a4db">#![no_std]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#![no_main]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">cortex_m_rt</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token plain">entry</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">defmt</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> info</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// use RTT for defmt transport</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> defmt_rtt </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">core</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">panic</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">PanicInfo</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[entry]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token macro property" style="color:#36acaa">info!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Device has started&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token macro property" style="color:#36acaa">panic!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;panic here&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[panic_handler]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">panic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token class-name">PanicInfo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property" style="color:#36acaa">error!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;{:?}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> info</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">loop</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>defmt</code> crate is used for logging, and two macros are employed in this example: <code>info!</code> and <code>error!</code>. The <code>info!</code> macro is used to log informational messages, such as when the device starts up. The <code>error!</code> macro is used in the panic handler to log error messages if the system encounters a panic.
The logging data is transmitted via <em>RTT</em> using the <code>defmt_rtt</code> crate, which is imported but not explicitly called.
The use of RTT enables real-time, high-speed communication between the embedded system and the host,
making it suitable for debugging in time-sensitive applications.</p>
<p>In the <code>main</code> function, the program begins by logging the message <code>&quot;Device has started&quot;</code> with the <code>info!</code> macro.
Following this, the <code>panic!</code> macro is called, simulating a panic condition. This could be triggered for various
reasons, such as an unexpected error or failed condition in the embedded system.</p>
<p>The <em>panic handler</em> logs the panic information using the <code>error!</code> macro. The <code>info</code> parameter passed to the panic handler contains details about the panic, which are logged for debugging purposes.
After logging the error, the program enters an infinite loop (<code>loop {}</code>) to prevent further execution,
effectively halting the system in a controlled manner. This is a common pattern in embedded systems when
handling critical errors or panics.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="filtering-messages">Filtering messages<a href="#filtering-messages" class="hash-link" aria-label="Direct link to Filtering messages" title="Direct link to Filtering messages">​</a></h4>
<p>Messages printed by <code>defmt</code> can be filetred using the <code>DEFMT_LOG</code> environemnt variable. The value
of this variable represents the lowest priority type of message the will be printed.</p>
<table><thead><tr><th>Message</th><th>Priority</th></tr></thead><tbody><tr><td><code>trace!</code></td><td>0</td></tr><tr><td><code>debug!</code></td><td>1</td></tr><tr><td><code>info!</code></td><td>2</td></tr><tr><td><code>warn!</code></td><td>3</td></tr><tr><td><code>error!</code></td><td>4</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>The <code>DEFMT_LOG</code> variable has to be set during the build.</p></div></div>
<p>To avoid setting this variable at every build, a <code>.cargo/config.toml</code> entry can be used.</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token table class-name">env</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key property" style="color:#36acaa">DEFMT_LOG</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;debug&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This example will ask <code>cargo run</code> to only print messages with a priority higher or equal to <code>debug!</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="semihosting-and-defmt">Semihosting and <code>defmt</code><a href="#semihosting-and-defmt" class="hash-link" aria-label="Direct link to semihosting-and-defmt" title="Direct link to semihosting-and-defmt">​</a></h3>
<p>This table show the advantages and disadvantages of both methods.</p>
<table><thead><tr><th>Feature</th><th>Semihosting</th><th><code>defmt</code></th></tr></thead><tbody><tr><td><strong>Performance</strong></td><td>Slow (halts CPU)</td><td>Fast (minimal overhead)</td></tr><tr><td><strong>Output Format</strong></td><td>Plain text (<code>hprintln!</code>)</td><td>Compressed binary logs</td></tr><tr><td><strong>Debugger Required?</strong></td><td>Yes</td><td>No (can use other transports)</td></tr><tr><td><strong>Memory Usage</strong></td><td>High (standard Rust formatting)</td><td>Low (compact binary format)</td></tr><tr><td><strong>Use Case</strong></td><td>Debugging with full text output</td><td>Real-time logging on embedded devices</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercises">Exercises<a href="#exercises" class="hash-link" aria-label="Direct link to Exercises" title="Direct link to Exercises">​</a></h2>
<ol>
<li>Create a new project using <code>cargo init</code>. Configure the project using a configuration file
to build for the lab board&#x27;s target. Test it by running <code>cargo build</code>. Take a look at <a href="#cross-compiling">Cross-compiling</a>(<strong>1p</strong>).</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>All you have to do is to make sure you are building a binary that does not depend on <code>std</code>, has no <code>main</code> function
and provides an <strong>empty panic handler</strong>.</p><p>To prevent <code>rust-analyzer</code> from showing an error on the first line and to automatically
format your source when saving, create a <code>.vscode/settings.json</code> file with:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;rust-analyzer.cargo.allTargets&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;[rust]&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;editor.defaultFormatter&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rust-lang.rust-analyzer&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;editor.formatOnSave&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;editor.formatOnSaveMode&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;file&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<ol start="2">
<li>Inspect the binary and figure out what sections are missing. Explain why each of the sections
is missing. take a look at <a href="#inspect-binaries">Inspect binaries</a>. (<strong>1p</strong>)</li>
<li>Add the <code>cortex-m-rt</code> crate to your project and define a
function as an <em>entry point</em> for your firmware. Inspect the binary and see which of the required sections are present. (<strong>1p</strong>)</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The <code>cargo add</code> command adds crates to a project.</p></div></div>
<ol start="4">
<li>Write a linker script to add the correct sections to your binary.
Take a look at <a href="#linker-script">Linker script</a>. Inspect the binary and check if the
required sections are present. (<strong>1p</strong>)</li>
<li>Write the build script to instruct the linker to use the linker script. Take a look at <a href="#build-script">Build script</a>.
Inspect the binary and see if the required sections are present. Is one of the sections missing? (<strong>1p</strong>)</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Make sure that the build script only uses linker scripts that exist in the project.
Some crates, like <code>cortex-m-rt</code> and <code>defmt</code> provide linker scripts.</p></div></div>
<ol start="6">
<li>Print a message from the main function using semihosting. Try running
the firmware using <code>probe-rs run target/...$app_name</code>. Why doesn&#x27;t it work? Take a look at <a href="#semihosting">Semihosting</a> (<strong>1p</strong>).</li>
<li>Add the <code>rp235x_hal</code> crate to the project and configure the <code>.start_block</code> and the <code>.end_block</code>. Take
a look at <a href="#the-start_block-and-end_blocks">The <code>.start_block</code> and <code>.end_block</code></a>. (<strong>1p</strong>)</li>
<li>Use semihosting to print the panic message in the <em>panic handler</em>. Use the <code>panic!</code> macro to
generate a panic. Take a look at <a href="#printing-the-panic">Printing the panic</a> (<strong>1p</strong>).</li>
<li>Use the <code>defmt</code> and <code>defmt_rtt</code> crates to print <code>info!</code> and <code>error!</code> messages. Generate a panic to verify the error message.
Take a look at <a href="#using-defmt">Using <code>defmt</code></a> (<strong>1p</strong>)</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li>Make sure you add all the necessary linker scripts to the <code>build.rs</code> build script.</li>
<li>Make sure you enable the <code>defmt</code> and <code>critical-section-impl</code> features of the <code>rp235x_hal</code> crate (<code>cargo add --features</code>).</li>
<li>Make sure you set the <code>DEFMT_LOG</code> variable to <code>info</code> when building to see the <code>info</code> messages or
use the <code>.cargo/config.toml</code> file (take a look at <a href="#filtering-messages">Filtering Messages</a>).</li>
<li>Messages are printed together with the location where the message was issued. To supress this
use the <code> --no-location</code> parameter for <code>probe-rs run</code>.</li>
</ul></div></div>
<ol start="10">
<li>Use the <code>panic-probe</code> crate to display better panics. (<strong>1p</strong>)</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li>This crate provides a panic handler.</li>
<li>Enable the <code>print-defmt</code> features of <code>panic-probe</code> to use <code>defmt</code> to print panics.</li>
</ul></div></div>
<ol start="11">
<li>Make the necessary configuration so that you can use <code>cargo run</code> to flash the firmware. Take a look
at <a href="#using-cargo-run">Using <code>cargo run</code></a> (<strong>1p</strong>)</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>You can add the <code>--no-location</code> parameter to the runner.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="vs-code-probe-rs-extension">VS Code probe-rs Extension<a href="#vs-code-probe-rs-extension" class="hash-link" aria-label="Direct link to VS Code probe-rs Extension" title="Direct link to VS Code probe-rs Extension">​</a></h2>
<p>The <a href="https://marketplace.visualstudio.com/items?itemName=probe-rs.probe-rs-debugger" target="_blank" rel="noopener noreferrer"><code>probe-rs</code> extension for <em>Visual Studio Code</em></a> is a powerful tool designed to streamline
the development and debugging of embedded Rust applications. It provides a seamless experience
for flashing firmware, setting breakpoints, and inspecting memory on embedded devices,
including the Raspberry Pi Pico 1 and Pico 2. By integrating with <code>probe-rs</code>, this extension
removes the complexity of configuring traditional debugging setups that rely on <em>GDB</em> and <em>OpenOCD</em>.</p>
<p>Using <code>probe-rs</code> within <em>VS Code</em> greatly simplifies the debugging workflow. Instead of manually
invoking command-line tools to flash firmware and debug, users can configure the extension via a
simple <code>launch.json</code> file. This configuration specifies the target chip, the firmware binary
to flash, and debugging options. Once set up, developers can start debugging with a
single click or by pressing <code>F5</code>, making the process efficient and user-friendly.</p>
<p>It integrates natively with <code>defmt</code>, allowing developers to view structured log messages
directly within VS Code’s terminal. This is especially useful for debugging
applications running on resource-constrained devices like the Raspberry Pi Pico 1 and Pico 2,
where traditional logging methods may be impractical.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="set-up-launchjson">Set up <code>launch.json</code><a href="#set-up-launchjson" class="hash-link" aria-label="Direct link to set-up-launchjson" title="Direct link to set-up-launchjson">​</a></h3>
<p>VS Code&#x27;s <code>probe-rs</code> extension uses a configuration file called <code>launch.json</code> located in the
<code>.vscode</code> folder of the project.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Raspberry Pi Pico 2</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Raspberry Pi Pico</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0.2.0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;configurations&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;preLaunchTask&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rust: cargo build&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;probe-rs-debug&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;request&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;launch&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Raspberry Pi Pico 2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;cwd&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;${workspaceFolder}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;connectUnderReset&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;chip&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;RP235x&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;flashingConfig&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;flashingEnabled&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;haltAfterReset&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;coreConfigs&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;coreIndex&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;programBinary&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./target/thumbv8m.main-none-eabihf/debug/${workspaceFolderBasename}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;svdFile&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./rp2350.svd&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;rttEnabled&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0.2.0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;configurations&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;preLaunchTask&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rust: cargo build&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;probe-rs-debug&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;request&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;launch&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Raspberry Pi Pico&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;cwd&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;${workspaceFolder}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;connectUnderReset&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;chip&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;RP2040&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;flashingConfig&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;flashingEnabled&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;haltAfterReset&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;coreConfigs&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;coreIndex&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;programBinary&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./target/thumbv6m-none-eabi/debug/${workspaceFolderBasename}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;svdFile&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./rp2040.svd&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;rttEnabled&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<p>This <code>launch.json</code> file configures VS Code&#x27;s <code>probe-rs</code> extension for debugging
firmware on the Raspberry Pi Pico. It defines how the debugger interacts
with the <code>RP235x</code> or the <code>RP2040</code> chip, including <em>flashing</em>, <em>RTT support</em>, and the
<em>firmware&#x27;s location</em>.</p>
<p>The <code>&quot;version&quot;: &quot;0.2.0&quot;</code> field specifies the configuration format. The
<code>&quot;configurations&quot;</code> array holds debug settings, with a single configuration
for the Pico.</p>
<p>Before debugging, <code>&quot;preLaunchTask&quot;: &quot;rust: cargo build&quot;</code> ensures the firmware
is compiled. The <code>&quot;type&quot;: &quot;probe-rs-debug&quot;</code> field tells <em>VS Code</em> to use
<code>probe-rs</code> as the debug backend. The <code>&quot;request&quot;: &quot;launch&quot;</code> mode starts a
new debugging session. The <code>&quot;name&quot;</code> field labels this configuration.</p>
<p>The <code>&quot;cwd&quot;: &quot;${workspaceFolder}&quot;</code> sets the working directory to the project
root. The <code>&quot;connectUnderReset&quot;: false</code> prevents connecting while the device
is held in reset. The <code>&quot;chip&quot;: &quot;RP235x&quot;</code> or <code>&quot;chip&quot;: &quot;RP2040&quot;</code> tells probe-rs which microcontroller<br>
<!-- -->is in use.</p>
<p>The <code>&quot;flashingConfig&quot;</code> section controls how firmware is written to flash.
With <code>&quot;flashingEnabled&quot;: true</code>, the firmware is flashed before debugging.
The <code>&quot;haltAfterReset&quot;: false</code> allows execution to continue after reset.</p>
<p>The <code>coreConfigs</code> array defines how individual CPU cores are handled. Since
RP235x has multiple cores, this example configures <strong>core 0</strong>. The firmware
binary is loaded from <code>./target/thumbv8m.main-none-eabihf/debug/${workspaceFolderBasename}</code>.
The <code>&quot;svdFile&quot;: &quot;./rp2350.svd&quot;</code> provides <strong>register descriptions</strong> for
debugging.</p>
<p>The <code>&quot;rttEnabled&quot;: true&quot;</code> setting enables <strong>Real-Time Transfer (RTT)</strong>,
allowing debug output to be streamed efficiently without interfering with
program execution. This is used for reading the messages sent by <code>defmt</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="running-the-firmware">Running the firmware<a href="#running-the-firmware" class="hash-link" aria-label="Direct link to Running the firmware" title="Direct link to Running the firmware">​</a></h3>
<p>This is how the <code>probe-rs</code> extension for <em>VS Code</em> UI looks like when
debugging firmware.</p>
<p><img decoding="async" loading="lazy" alt="probe-rs VSCode extension" src="/assets/images/probe_rs_vscode-8f0dd60a4e0305f19b7ca9ef6a37cc9f.webp" width="2380" height="1556" class="img_ev3q"></p>
<p>To run firmware on the Raspberry Pi Pico 1 or 2 using the <code>probe-rs</code> extension
in <em>Visual Studio Code</em>, open your project and ensure your <code>launch.json</code>
file is <a href="#set-up-launchjson">correctly configured</a>. Before starting, connect
your <em>debugger</em>* to the Pico and power the board.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>If you are using the lab board, please make sure you are using the USB-C connector.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="starting-the-debugging-session">Starting the Debugging Session<a href="#starting-the-debugging-session" class="hash-link" aria-label="Direct link to Starting the Debugging Session" title="Direct link to Starting the Debugging Session">​</a></h4>
<ol>
<li>Open the <strong>Run and Debug</strong> panel in VS Code by clicking the <strong>Run</strong> icon<br>
<!-- -->in the left sidebar or pressing <code>Ctrl+Shift+D</code>.</li>
<li>Select <em>&quot;Raspberry Pi Pico 2&quot;</em> (or the name of your configuration) from<br>
<!-- -->the drop-down menu at the top of the panel.</li>
<li>Click the <strong>Start Debugging</strong> button (<span style="color:green">▶</span>), or press <code>F5</code>.</li>
</ol>
<p>The firmware will be flashed automatically if <code>&quot;flashingEnabled&quot;: true</code> is
set in <code>launch.json</code>. Once the process completes, execution starts, and the
debugger attaches to the target.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="checking-for-errors-and-debug-output">Checking for Errors and Debug Output<a href="#checking-for-errors-and-debug-output" class="hash-link" aria-label="Direct link to Checking for Errors and Debug Output" title="Direct link to Checking for Errors and Debug Output">​</a></h4>
<p>If something goes wrong, look for errors in the <strong>PROBLEMS</strong> tab at the
bottom of <em>VS Code</em>. If flashing fails, check the <strong>TERMINAL</strong> or <strong>DEBUG
CONSOLE</strong> for <code>probe-rs</code> messages. Common issues include:</p>
<ul>
<li>The <em>debug probe is not detected</em>. Try reconnecting the hardware.</li>
<li>The <em>Pico is not powered on</em>. Ensure proper connections.</li>
<li><em>Flashing errors</em> due to a missing or corrupted firmware binary.</li>
</ul>
<p>If using <code>defmt</code> for logging, open the <strong>TERMINAL</strong> to see formatted
debug messages. If <em>RTT</em> is enabled (<code>&quot;rttEnabled&quot;: true</code>), <code>defmt</code> output will
stream here in real-time.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="stopping-the-running-firmware">Stopping the Running Firmware<a href="#stopping-the-running-firmware" class="hash-link" aria-label="Direct link to Stopping the Running Firmware" title="Direct link to Stopping the Running Firmware">​</a></h4>
<p>To stop execution, press the <strong>Stop Debugging</strong> button (<span style="color:orange">■</span>) in the debug
toolbar or use the shortcut <code>Shift+F5</code>. This halts the processor and
disconnects the debugger. If the device is still running after stopping,
you may need to <strong>power-cycle</strong> the Pico to fully reset it.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-breakpoints">Using Breakpoints<a href="#using-breakpoints" class="hash-link" aria-label="Direct link to Using Breakpoints" title="Direct link to Using Breakpoints">​</a></h3>
<p>When debugging firmware on the Raspberry Pi Pico 1 and 2 using the <code>probe-rs</code>
extension in <em>Visual Studio Code</em>, breakpoints allow you to pause execution
at specific lines of code, while stepping lets you <em>move through code
line-by-line</em> to inspect its behavior.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="placing-a-breakpoint">Placing a Breakpoint<a href="#placing-a-breakpoint" class="hash-link" aria-label="Direct link to Placing a Breakpoint" title="Direct link to Placing a Breakpoint">​</a></h4>
<ol>
<li>Open the Rust source file you want to debug.</li>
<li>Click in the <strong>gutter</strong> (left margin) next to a line of code where you
want execution to pause. A <strong>red dot</strong> will appear, indicating an
<strong>active breakpoint</strong>.</li>
<li>Alternatively, place the cursor on a line and press <code>F9</code> to toggle a
breakpoint.</li>
</ol>
<p>Breakpoints are <strong>only effective in code that is actually executed</strong>. If a
breakpoint is placed on an unused function, it will be ignored.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="starting-and-hitting-a-breakpoint">Starting and Hitting a Breakpoint<a href="#starting-and-hitting-a-breakpoint" class="hash-link" aria-label="Direct link to Starting and Hitting a Breakpoint" title="Direct link to Starting and Hitting a Breakpoint">​</a></h4>
<ol>
<li>Start debugging with <code>F5</code> (or the <strong>Start Debugging</strong> button in the
<strong>Run and Debug</strong> panel).</li>
<li>When execution reaches a breakpoint, the program <strong>pauses</strong> at that
line, allowing you to inspect variables and memory.</li>
<li>Hover over variables to see their values or use the <strong>Variables</strong>
panel in the Debug sidebar.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="stepping-through-code">Stepping Through Code<a href="#stepping-through-code" class="hash-link" aria-label="Direct link to Stepping Through Code" title="Direct link to Stepping Through Code">​</a></h4>
<p>When a breakpoint is hit, you can control execution using the <strong>Debug Toolbar</strong>:</p>
<ul>
<li><strong>Step Over (<code>F10</code>)</strong> → Executes the current line and moves to the next.
If the line contains a function call, the function runs but isn’t entered.</li>
<li><strong>Step Into (<code>F11</code>)</strong> → Enters a function call to debug inside it.</li>
<li><strong>Step Out (<code>Shift+F11</code>)</strong> → Runs until the current function returns.</li>
<li><strong>Continue (<code>F5</code>)</strong> → Resumes execution until the next breakpoint or<br>
<!-- -->program end.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="removing-or-disabling-breakpoints">Removing or Disabling Breakpoints<a href="#removing-or-disabling-breakpoints" class="hash-link" aria-label="Direct link to Removing or Disabling Breakpoints" title="Direct link to Removing or Disabling Breakpoints">​</a></h4>
<p>To remove a breakpoint, click the <strong>red dot</strong> again or press <code>F9</code> on the
selected line. To temporarily disable a breakpoint, right-click it and
select <strong>Disable Breakpoint</strong>.</p>
<p>Using breakpoints and stepping makes it easier to understand how firmware
executes and diagnose issues efficiently in <code>probe-rs</code> with VS Code.</p>
<p><img decoding="async" loading="lazy" alt="probe-rs VS Code extension debug" src="/assets/images/probe_rs_debug-31f94da4e6546286fb855091f4bdcb22.webp" width="2380" height="1556" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="watches">Watches<a href="#watches" class="hash-link" aria-label="Direct link to Watches" title="Direct link to Watches">​</a></h3>
<p>The <code>probe-rs</code> extension in <em>VS Code</em> provides powerful debugging tools<br>
<!-- -->to inspect variables, function execution, and hardware registers while
developing firmware for the Raspberry Pi Pico 2.</p>
<p>The <strong>WATCH</strong> panel in VS Code allows developers to track specific
variables and expressions while debugging. This is useful for monitoring
register values, checking memory locations, and debugging complex logic.</p>
<ol>
<li>Start debugging (<code>F5</code>) and hit a <strong>breakpoint</strong> where you want to inspect
variables.</li>
<li>Open the <strong>WATCH</strong> panel in the Debug sidebar.</li>
<li>Click <strong>&quot;Add Expression&quot;</strong> and enter a variable name or memory address.<!-- -->
<ul>
<li>Example: <code>some_variable</code> (for normal variables).</li>
<li>Example: <code>*(0xD0000014 as *const u32)</code> (to read a register).</li>
</ul>
</li>
<li>The expression updates each time the debugger stops.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="call-stack-tracing-function-execution">Call Stack: Tracing Function Execution<a href="#call-stack-tracing-function-execution" class="hash-link" aria-label="Direct link to Call Stack: Tracing Function Execution" title="Direct link to Call Stack: Tracing Function Execution">​</a></h3>
<p>The <strong>CALL STACK</strong> panel shows the sequence of function calls that led to<br>
<!-- -->the current execution point. This is essential for understanding how the<br>
<!-- -->program reached a specific line of code.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-use-the-call-stack">How to Use the Call Stack<a href="#how-to-use-the-call-stack" class="hash-link" aria-label="Direct link to How to Use the Call Stack" title="Direct link to How to Use the Call Stack">​</a></h4>
<ol>
<li>When execution stops at a breakpoint, check the <strong>CALL STACK</strong> panel.</li>
<li>The top function is the <strong>currently executing function</strong>.</li>
<li>Clicking on any function in the stack navigates to its source.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="why-use-the-call-stack">Why Use the Call Stack?<a href="#why-use-the-call-stack" class="hash-link" aria-label="Direct link to Why Use the Call Stack?" title="Direct link to Why Use the Call Stack?">​</a></h4>
<ul>
<li>Understand <strong>nested function calls</strong> (e.g., deep function recursion).</li>
<li>Debug <strong>unexpected behavior</strong> by seeing which path the code took.</li>
<li>Find where a <strong>panic</strong> originated in case of a crash.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="peripherals-inspecting-hardware-registers">Peripherals: Inspecting Hardware Registers<a href="#peripherals-inspecting-hardware-registers" class="hash-link" aria-label="Direct link to Peripherals: Inspecting Hardware Registers" title="Direct link to Peripherals: Inspecting Hardware Registers">​</a></h3>
<p>The <strong>Peripherals</strong> panel lets you inspect hardware registers based on
the <strong>SVD (System View Description) file</strong> for the <strong>RP235x</strong> or <strong>RP2040</strong> chip. This
allows direct observation of GPIO states, timers, UART, and more.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Please make sure that the project folder contains the correct SVD file.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="svd-files-for-the-raspberry-pi-pico">SVD Files for The Raspberry Pi Pico<a href="#svd-files-for-the-raspberry-pi-pico" class="hash-link" aria-label="Direct link to SVD Files for The Raspberry Pi Pico" title="Direct link to SVD Files for The Raspberry Pi Pico">​</a></h4>
<table><thead><tr><th>Processor</th><th>Crate that provides the SVD File</th></tr></thead><tbody><tr><td><em>RP2350</em></td><td><a href="https://github.com/rp-rs/rp235x-pac/tree/main/svd" target="_blank" rel="noopener noreferrer">rp235x_pac</a></td></tr><tr><td><em>RP2040</em></td><td><a href="https://github.com/rp-rs/rp2040-pac/tree/main/svd" target="_blank" rel="noopener noreferrer">rp2040_pac</a></td></tr></tbody></table>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Make sure you download the <code>.pacthed</code> versions of the files.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-enable-peripheral-debugging">How to Enable Peripheral Debugging<a href="#how-to-enable-peripheral-debugging" class="hash-link" aria-label="Direct link to How to Enable Peripheral Debugging" title="Direct link to How to Enable Peripheral Debugging">​</a></h4>
<ol>
<li>Ensure <code>&quot;svdFile&quot;: &quot;./rp2350.svd&quot;</code> or <code>&quot;svdFile&quot;: &quot;./rp2040.svd&quot;</code> is set in <code>launch.json</code>.</li>
<li>Start debugging and hit a <strong>breakpoint</strong>.</li>
<li>Open the <strong>Peripherals</strong> panel in the Debug sidebar.</li>
<li>Expand peripheral groups (e.g., <code>GPIO</code>, <code>TIMER</code>, <code>UART</code>) to see
live register values.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="why-use-the-peripherals-panel"><strong>Why Use the Peripherals Panel?</strong><a href="#why-use-the-peripherals-panel" class="hash-link" aria-label="Direct link to why-use-the-peripherals-panel" title="Direct link to why-use-the-peripherals-panel">​</a></h4>
<ul>
<li>Observe <strong>hardware state changes</strong> while stepping through code.</li>
<li>Debug <strong>GPIO settings, clock configurations, and interrupts</strong>.</li>
<li>Avoid manual memory reads by using <strong>structured register views</strong>.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="extra-exercises">Extra exercises<a href="#extra-exercises" class="hash-link" aria-label="Direct link to Extra exercises" title="Direct link to Extra exercises">​</a></h2>
<ol>
<li>Setup the <code>probe-rs</code> VS Code Extension to run the firmare directly from <em>Visual Studio Code</em>.</li>
<li>Define a few variables throughout the firmware and perform some math. Use the <code>probe-rs</code> VS Code extension
to go step by step throughout the running firmware and look at the variables using the <strong>Watches</strong>.</li>
<li>Define a few fuctions throughout the firmware and perform some math. Use the <code>probe-rs</code> VS Code extension
to go step by step through the running firmware and look at the called functions using the <strong>Call Stack</strong>.</li>
</ol>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_LWe7 sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-firmware">
<p>Software that is running on microcontrollers is usually called <em>firmware</em>. The words is a combination of the words <em>firm</em> and <em>software</em> and means the software that the vendor firm of the device has uploaded. <a href="#user-content-fnref-firmware" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://www.github.com/upb-pmrust/website/edit/main/website/lab/01/index.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/fils_en/lab/00"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">00 - Intro to Rust</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/fils_en/lab/02"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">02 - GPIO</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#concepts" class="table-of-contents__link toc-highlight">Concepts</a></li><li><a href="#resources" class="table-of-contents__link toc-highlight">Resources</a></li><li><a href="#software-prerequisites" class="table-of-contents__link toc-highlight">Software Prerequisites</a></li><li><a href="#debugger" class="table-of-contents__link toc-highlight">Debugger</a><ul><li><a href="#raspberry-pi-debug-probe" class="table-of-contents__link toc-highlight">Raspberry Pi Debug Probe</a></li><li><a href="#secondary-pico" class="table-of-contents__link toc-highlight">Secondary Pico</a></li></ul></li><li><a href="#debugger-software" class="table-of-contents__link toc-highlight">Debugger software</a></li><li><a href="#cross-compiling" class="table-of-contents__link toc-highlight">Cross-compiling</a><ul><li><a href="#using-a-configuration-file" class="table-of-contents__link toc-highlight">Using a configuration file</a></li></ul></li><li><a href="#binary-format" class="table-of-contents__link toc-highlight">Binary format</a><ul><li><a href="#sections" class="table-of-contents__link toc-highlight">Sections</a></li><li><a href="#linker-script" class="table-of-contents__link toc-highlight">Linker Script</a></li><li><a href="#build-script" class="table-of-contents__link toc-highlight">Build Script</a></li><li><a href="#inspect-binaries" class="table-of-contents__link toc-highlight">Inspect binaries</a></li><li><a href="#check-section-headers" class="table-of-contents__link toc-highlight">Check section headers</a></li></ul></li><li><a href="#empty-firmware" class="table-of-contents__link toc-highlight">Empty firmware</a><ul><li><a href="#the-interrupt_vector-section" class="table-of-contents__link toc-highlight">The <code>.interrupt_vector</code> section</a></li><li><a href="#the-start_block-and-end_blocks" class="table-of-contents__link toc-highlight">The <code>.start_block</code> and <code>.end_block</code>s</a></li><li><a href="#the-main-function" class="table-of-contents__link toc-highlight">The <code>main</code> function</a></li></ul></li><li><a href="#flashing-firmware" class="table-of-contents__link toc-highlight">Flashing firmware</a><ul><li><a href="#using-cargo-run" class="table-of-contents__link toc-highlight">Using <code>cargo run</code></a></li></ul></li><li><a href="#printing-messages" class="table-of-contents__link toc-highlight">Printing messages</a><ul><li><a href="#semihosting" class="table-of-contents__link toc-highlight">Semihosting</a></li><li><a href="#using-defmt" class="table-of-contents__link toc-highlight">Using <code>defmt</code></a></li><li><a href="#semihosting-and-defmt" class="table-of-contents__link toc-highlight">Semihosting and <code>defmt</code></a></li></ul></li><li><a href="#exercises" class="table-of-contents__link toc-highlight">Exercises</a></li><li><a href="#vs-code-probe-rs-extension" class="table-of-contents__link toc-highlight">VS Code probe-rs Extension</a><ul><li><a href="#set-up-launchjson" class="table-of-contents__link toc-highlight">Set up <code>launch.json</code></a></li><li><a href="#running-the-firmware" class="table-of-contents__link toc-highlight">Running the firmware</a></li><li><a href="#using-breakpoints" class="table-of-contents__link toc-highlight">Using Breakpoints</a></li><li><a href="#watches" class="table-of-contents__link toc-highlight">Watches</a></li><li><a href="#call-stack-tracing-function-execution" class="table-of-contents__link toc-highlight">Call Stack: Tracing Function Execution</a></li><li><a href="#peripherals-inspecting-hardware-registers" class="table-of-contents__link toc-highlight">Peripherals: Inspecting Hardware Registers</a></li></ul></li><li><a href="#extra-exercises" class="table-of-contents__link toc-highlight">Extra exercises</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Politehnica Bucharest &amp; <a href="https://wyliodrin.com" target="_blank">Wyliodrin SRL</a>, licensed under CC BY-SA 4.0.</div></div></div></footer></div>
</body>
</html>